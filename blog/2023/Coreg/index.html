<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>DEM Coreg is a bound-restricted minimizing problem | Zhihao LIU</title> <meta name="author" content="Zhihao LIU"/> <meta name="description" content="but suffering from noise"/> <meta name="keywords" content="geoscience, geospatial data science, geomorphology, seismic, energy transition, marathon"/> <meta property="og:site_name" content="Zhihao LIU"/> <meta property="og:type" content="website"/> <meta property="og:title" content="Zhihao LIU | DEM Coreg is a bound-restricted minimizing problem"/> <meta property="og:url" content="https://zhihaol.eu.org/blog/2023/Coreg/"/> <meta property="og:description" content="but suffering from noise"/> <meta property="og:locale" content="en"/> <meta name="twitter:card" content="summary"/> <meta name="twitter:title" content="DEM Coreg is a bound-restricted minimizing problem"/> <meta name="twitter:description" content="but suffering from noise"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ““</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://zhihaol.eu.org/blog/2023/Coreg/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://zhihaol.eu.org/"><span class="font-weight-bold">ZhihaoÂ </span>LIU</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">DEM Coreg is a bound-restricted minimizing problem</h1> <p class="post-meta">January 2, 2023â€¢ Zhihao</p> <p class="post-tags"> <a href="https://zhihaol.eu.org/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a> Â  Â· Â  <a href="https://zhihaol.eu.org/blog/tag/notes"> <i class="fas fa-hashtag fa-sm"></i> notes</a> Â  Â  Â· Â  <a href="https://zhihaol.eu.org/blog/category/geodata"> <i class="fas fa-tag fa-sm"></i> geodata</a> Â  <a href="https://zhihaol.eu.org/blog/category/datascience"> <i class="fas fa-tag fa-sm"></i> datascience</a> Â  </p> </header> <article class="post-content"> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">importlib</span> <span class="kn">import</span> <span class="nb">reload</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">xdem</span>
<span class="kn">import</span> <span class="n">xsnow</span>
<span class="kn">from</span> <span class="n">xsnow.godh</span> <span class="kn">import</span> <span class="n">load_gdf</span><span class="p">,</span><span class="n">best_shift_px</span><span class="p">,</span><span class="n">get_dh_by_shift_px_gdf</span><span class="p">,</span><span class="n">load_gdf</span>
<span class="kn">from</span> <span class="n">xsnow.misc</span> <span class="kn">import</span> <span class="n">df_sampling_from_dem</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">reload</span><span class="p">(</span><span class="n">xsnow</span><span class="p">.</span><span class="n">misc</span><span class="p">)</span>
<span class="nf">reload</span><span class="p">(</span><span class="n">xsnow</span><span class="p">.</span><span class="n">godh</span><span class="p">)</span>
<span class="nf">reload</span><span class="p">(</span><span class="n">xdem</span><span class="p">)</span>
<span class="nf">reload</span><span class="p">(</span><span class="n">xdem</span><span class="p">.</span><span class="n">coreg</span><span class="p">)</span>
<span class="kn">from</span> <span class="n">importlib</span> <span class="kn">import</span> <span class="nb">reload</span>
<span class="kn">import</span> <span class="n">xsnow</span>
<span class="kn">import</span> <span class="n">xsnow.godh</span>
</code></pre></div></div> <h2 id="dem-coreg-is-a-bound-restricted-minimizing-problem">DEM Coreg is a bound-restricted minimizing problem.</h2> <ul> <li>DEM Coreg is a bound-restricted minimizing problem, but suffering from noise.</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Loading the dataset.
</span>
<span class="c1"># 1 ICESat-2 snow free measurements.
</span><span class="n">sf_gdf</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">snow_free_land_gdf_normal_qc.csv</span><span class="sh">'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sh">'</span><span class="se">\t</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># 2 DTM 10 exmaple (10 m Norway DTM-10)
#fid_dtm10 = r'\\hypatia.uio.no\lh-mn-geofag-felles\projects\snowdepth\zhihaol\data\dtm10_finse_merged.tif'
</span><span class="n">fid_dtm10</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">\\hypatia.uio.no\lh-mn-geofag-felles\projects\snowdepth\data\DEM\Norway\DTM10_UTM33\6702_4_10m_z33.tif</span><span class="sh">'</span>

<span class="n">dtm_10_</span> <span class="o">=</span> <span class="n">xdem</span><span class="p">.</span><span class="nc">DEM</span><span class="p">(</span><span class="n">fid_dtm10</span><span class="p">)</span>
<span class="n">dtm_10</span> <span class="o">=</span> <span class="n">dtm_10_</span> <span class="o">+</span> <span class="n">xdem</span><span class="p">.</span><span class="nc">DEM</span><span class="p">(</span><span class="sh">'</span><span class="s">no_kv_HREF2018B_NN2000_EUREF89.tif</span><span class="sh">'</span><span class="p">).</span><span class="nf">reproject</span><span class="p">(</span><span class="n">dtm_10_</span><span class="p">,</span><span class="n">resampling</span><span class="o">=</span><span class="sh">'</span><span class="s">bilinear</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># 3 DTM 1 exmaple (1 m Norway DTM-1)
</span><span class="n">fid_dtm1</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">\\hypatia.uio.no\lh-mn-geofag-felles\projects\snowdepth\data\DEM\Norway\DTM1_UTM33\DTM1_11-11_UTM33\33-113-119.tif</span><span class="sh">'</span>
<span class="n">dtm_1_</span> <span class="o">=</span> <span class="n">xdem</span><span class="p">.</span><span class="nc">DEM</span><span class="p">(</span><span class="n">fid_dtm1</span><span class="p">)</span>
<span class="n">dtm_1</span> <span class="o">=</span> <span class="n">dtm_1_</span> <span class="o">+</span> <span class="n">xdem</span><span class="p">.</span><span class="nc">DEM</span><span class="p">(</span><span class="sh">'</span><span class="s">no_kv_HREF2018B_NN2000_EUREF89.tif</span><span class="sh">'</span><span class="p">).</span><span class="nf">reproject</span><span class="p">(</span><span class="n">dtm_1_</span><span class="p">,</span><span class="n">resampling</span><span class="o">=</span><span class="sh">'</span><span class="s">bilinear</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># subset snow free measurements
</span><span class="kn">from</span> <span class="n">xsnow.godh</span> <span class="kn">import</span> <span class="n">load_gdf</span>
<span class="n">sf_subset_dtm10_</span> <span class="o">=</span> <span class="nf">load_gdf</span><span class="p">(</span><span class="n">sf_gdf</span><span class="p">,</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">z_name</span><span class="o">=</span><span class="sh">'</span><span class="s">h_te_best_fit</span><span class="sh">'</span><span class="p">)</span>
<span class="n">sf_subset_dtm1_</span> <span class="o">=</span> <span class="nf">load_gdf</span><span class="p">(</span><span class="n">sf_gdf</span><span class="p">,</span><span class="n">dtm_1</span><span class="p">,</span><span class="n">z_name</span><span class="o">=</span><span class="sh">'</span><span class="s">h_te_best_fit</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">The length of sf_subset_dtm10: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">sf_subset_dtm10_</span><span class="p">)</span><span class="si">}</span><span class="s"> points</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">The length of sf_subset_dtm1: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">sf_subset_dtm1_</span><span class="p">)</span><span class="si">}</span><span class="s"> points</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The length of sf_subset_dtm10: 44149 points
The length of sf_subset_dtm1: 1586 points
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">xdem</span>
<span class="kn">from</span> <span class="n">xsnow.misc</span> <span class="kn">import</span> <span class="n">df_sampling_from_dem</span>

<span class="k">def</span> <span class="nf">yield_surface_noise</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">sf_gdf_subset</span><span class="p">,</span>
                        <span class="n">bond</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">stat</span><span class="o">=</span><span class="sh">'</span><span class="s">nmad</span><span class="sh">'</span><span class="p">,</span> <span class="n">number_corg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">downsampling_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">z_name</span><span class="o">=</span><span class="sh">'</span><span class="s">h_te_best_fit</span><span class="sh">'</span><span class="p">,</span>
                        <span class="n">nuthkaab</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">gdc_qc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="n">number_corg</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">number_corg</span> <span class="o">=</span> <span class="mi">1</span>
        
    <span class="k">if</span> <span class="n">downsampling_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sampling</span> <span class="ow">in</span> <span class="n">downsampling_list</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="nf">best_shift_px</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span> <span class="n">sf_gdf_subset</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">stat</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="n">perc_t</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="n">std_t</span><span class="p">,</span> <span class="n">downsampling</span><span class="o">=</span><span class="n">sampling</span><span class="p">,</span><span class="n">z_name</span><span class="o">=</span><span class="n">z_name</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">number_corg</span><span class="p">)]</span>
            <span class="n">nmad</span><span class="p">,</span><span class="n">rmse</span><span class="p">,</span><span class="n">std</span><span class="p">,</span><span class="n">median</span> <span class="o">=</span> <span class="nf">surface_noise</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">sf_gdf_subset</span><span class="p">,</span><span class="n">bond</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="n">perc_t</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="n">std_t</span><span class="p">,</span><span class="n">downsampling</span><span class="o">=</span><span class="n">sampling</span><span class="p">,</span><span class="n">z_name</span><span class="o">=</span><span class="n">z_name</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">nuthkaab</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="n">xdem</span><span class="p">.</span><span class="n">coreg</span><span class="p">.</span><span class="nc">NuthKaab</span><span class="p">()</span>
                    <span class="n">func</span><span class="p">.</span><span class="nf">fit_pts</span><span class="p">(</span><span class="n">sf_gdf_subset</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">sampling</span><span class="o">/</span><span class="nf">len</span><span class="p">(</span><span class="n">sf_gdf_subset</span><span class="p">),</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">mask_highcurv</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="n">res_nk</span> <span class="o">=</span> <span class="p">(</span><span class="n">func</span><span class="p">.</span><span class="n">_meta</span><span class="p">[</span><span class="sh">"</span><span class="s">offset_east_px</span><span class="sh">"</span><span class="p">],</span><span class="n">func</span><span class="p">.</span><span class="n">_meta</span><span class="p">[</span><span class="sh">"</span><span class="s">offset_north_px</span><span class="sh">"</span><span class="p">],</span><span class="n">func</span><span class="p">.</span><span class="n">_meta</span><span class="p">[</span><span class="sh">"</span><span class="s">bias</span><span class="sh">"</span><span class="p">],</span><span class="n">func</span><span class="p">.</span><span class="n">_meta</span><span class="p">[</span><span class="sh">"</span><span class="s">nmad</span><span class="sh">"</span><span class="p">])</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">NuthKaab coreg on </span><span class="si">{</span><span class="n">sampling</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">res_nk</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
                <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
                    <span class="n">res_nk</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res_nk</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">if</span> <span class="n">gdc_qc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">sf_subset_dtm10_ref</span> <span class="o">=</span> <span class="n">sf_gdf_subset</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="sh">'</span><span class="s">subset_te_flag == 5</span><span class="sh">'</span><span class="p">)</span>
                <span class="n">res_qc</span> <span class="o">=</span> <span class="nf">best_shift_px</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span> <span class="n">sf_subset_dtm10_ref</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">stat</span><span class="o">=</span><span class="n">stat</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="n">perc_t</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="n">std_t</span><span class="p">,</span> <span class="n">downsampling</span><span class="o">=</span><span class="n">sampling</span><span class="p">,</span><span class="n">z_name</span><span class="o">=</span><span class="n">z_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res_qc</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="k">yield</span> <span class="n">nmad</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_qc</span><span class="p">,</span><span class="nf">min</span><span class="p">(</span><span class="n">sampling</span><span class="p">,</span><span class="nf">len</span><span class="p">(</span><span class="n">sf_gdf_subset</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">surface_noise</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">sf_gdf_subset</span><span class="p">,</span><span class="n">bond</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">downsampling</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">z_name</span><span class="o">=</span><span class="sh">'</span><span class="s">h_te_best_fit</span><span class="sh">'</span><span class="p">):</span>

    <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">sf_gdf_subset</span><span class="p">,</span><span class="n">xdem</span><span class="p">.</span><span class="n">DEM</span><span class="p">):</span>
        <span class="n">sf_gdf_subset</span> <span class="o">=</span> <span class="nf">df_sampling_from_dem</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">sf_gdf_subset</span><span class="p">,</span><span class="n">samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">downsampling</span> <span class="ow">and</span> <span class="nf">len</span><span class="p">(</span><span class="n">sf_gdf_subset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">downsampling</span><span class="p">:</span>
        <span class="n">sf_gdf_subset</span> <span class="o">=</span> <span class="n">sf_gdf_subset</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">downsampling</span><span class="o">/</span><span class="nf">len</span><span class="p">(</span><span class="n">sf_gdf_subset</span><span class="p">),</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">).</span><span class="nf">copy</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Running on downsampling. The length of the gdf:</span><span class="sh">'</span><span class="p">,</span><span class="nf">len</span><span class="p">(</span><span class="n">sf_gdf_subset</span><span class="p">))</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Set downsampling = other value or False to make a change.</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">bond_</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">bond</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">nmad</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">bond_</span><span class="p">),</span><span class="nf">len</span><span class="p">(</span><span class="n">bond_</span><span class="p">)))</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">bond_</span><span class="p">),</span><span class="nf">len</span><span class="p">(</span><span class="n">bond_</span><span class="p">)))</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">bond_</span><span class="p">),</span><span class="nf">len</span><span class="p">(</span><span class="n">bond_</span><span class="p">)))</span>
    <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">bond_</span><span class="p">),</span><span class="nf">len</span><span class="p">(</span><span class="n">bond_</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">e</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nf">product</span><span class="p">(</span><span class="n">bond_</span><span class="p">,</span><span class="n">bond_</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="nf">get_dh_by_shift_px_gdf</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">sf_gdf_subset</span><span class="p">,(</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">stat</span><span class="o">=</span><span class="sh">'</span><span class="s">all</span><span class="sh">'</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="n">perc_t</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="n">std_t</span><span class="p">,</span><span class="n">z_name</span><span class="o">=</span><span class="n">z_name</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">bond</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">col</span> <span class="o">=</span> <span class="nf">int</span><span class="p">((</span><span class="n">e</span><span class="o">-</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">bond</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">nmad</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">nmad</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">rmse</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">rmse</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">std</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">std</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">median</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">median</span><span class="sh">'</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">nmad</span><span class="p">,</span><span class="n">rmse</span><span class="p">,</span><span class="n">std</span><span class="p">,</span><span class="n">median</span>

<span class="k">def</span> <span class="nf">surface_plot</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                 <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">res</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">res_2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">res_3</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">minimal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">[m]</span><span class="sh">'</span><span class="p">,</span>
                 <span class="n">z_step_level</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">zlim_s</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">projection</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">3d</span><span class="sh">"</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xlim</span><span class="o">=</span><span class="n">bond</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ylim</span><span class="o">=</span><span class="n">bond</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Make a grid.
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">bond</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

    <span class="c1"># plot minimal
</span>    <span class="n">zmin</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    <span class="n">zmax</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span> <span class="o">==</span> <span class="n">zmin</span>
    <span class="c1">#color = np.where(mask,'blue','red')
</span>    
    <span class="c1"># Plot the 3D surface
</span>    <span class="n">ax</span><span class="p">.</span><span class="nf">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="sh">'</span><span class="s">royalblue</span><span class="sh">'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Plot projections of the contours for each dimension.  By choosing offsets
</span>    <span class="c1"># that match the appropriate axes limits, the projected contours will sit on
</span>    <span class="c1"># the 'walls' of the graph.
</span>    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">z_step_level</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="sh">'</span><span class="s">levels</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">+</span> <span class="n">z_step_level</span><span class="p">,</span> <span class="n">z_step_level</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z_step_level</span> <span class="o">=</span> <span class="n">zlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">zlim_s</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="sh">'</span><span class="s">levels</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">+</span> <span class="n">z_step_level</span><span class="p">,</span> <span class="n">z_step_level</span><span class="p">)</span>


    <span class="n">z_contour</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span><span class="n">zdir</span><span class="o">=</span><span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">coolwarm</span><span class="sh">'</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">coolwarm</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">coolwarm_r</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1">#ax.clabel(z_contour, kwargs['levels'][0::2], z_contour.levels[::2], inline=True,fmt ='%1.1f', colors='black', fontsize='x-large')
</span>
    <span class="k">if</span> <span class="n">minimal</span><span class="p">:</span>
        <span class="c1"># scatter minimal on bottom
</span>        <span class="n">ax</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">minimal</span><span class="sh">'</span><span class="p">)</span>
        <span class="c1">#scatter minimal on z-axis
</span>        <span class="n">ax</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zmin</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="sh">"</span><span class="s">x</span><span class="sh">"</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># plot gradient results
</span>    <span class="k">if</span> <span class="n">res</span><span class="p">:</span>

        <span class="c1"># plot [0,0] on bottom
</span>        <span class="n">ax</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">,</span><span class="n">edgecolors</span><span class="o">=</span><span class="sh">'</span><span class="s">white</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">(0,0)</span><span class="sh">'</span><span class="p">)</span>

        <span class="c1"># plot [shift matrix] by gradient descending on bottom
</span>        <span class="n">_x</span><span class="p">,</span><span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">res</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">res</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">_nmad</span><span class="p">,</span><span class="n">_rmse</span><span class="p">,</span><span class="n">_std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">res</span><span class="p">)[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">res</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">],</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">res</span><span class="p">)[:,</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">ax</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">GDC</span><span class="sh">'</span><span class="p">)</span>

        <span class="c1"># plot shift matrix on z axis
</span>        <span class="k">if</span> <span class="n">zlabel</span> <span class="o">==</span> <span class="sh">'</span><span class="s">NMAD [m]</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">_z</span> <span class="o">=</span> <span class="n">_nmad</span>
        <span class="k">if</span> <span class="n">zlabel</span> <span class="o">==</span> <span class="sh">'</span><span class="s">RMSE [m]</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">_z</span> <span class="o">=</span> <span class="n">_rmse</span>
        <span class="k">if</span> <span class="n">zlabel</span> <span class="o">==</span> <span class="sh">'</span><span class="s">STD [m]</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">_z</span> <span class="o">=</span> <span class="n">_std</span>
        
        <span class="c1">#ax.scatter([xlim[1]]*len(_x), [ylim[1]]*len(_y),_z, marker="x", color='green')
</span>    
    <span class="c1"># plot nuthkaab results
</span>    <span class="k">if</span> <span class="n">res_1</span><span class="p">:</span>
        <span class="c1"># plot [shift matrix] by gradient descending on bottom
</span>        <span class="n">ax</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">res_1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">NuthKaab</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># plot reference results
</span>    <span class="k">if</span> <span class="n">res_2</span><span class="p">:</span>
        <span class="c1"># plot [shift matrix] by gradient descending on bottom
</span>        <span class="n">ax</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">res_2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res_2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">purple</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">GDC_qc</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">res_3</span><span class="p">:</span>
        <span class="c1"># plot [shift matrix] by gradient descending on bottom
</span>        <span class="n">ax</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">res_2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res_2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">others</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span> <span class="n">zlim</span><span class="o">=</span><span class="n">zlim</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">Shifted E [px]</span><span class="sh">'</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sh">'</span><span class="s">Shifted N [px]</span><span class="sh">'</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="n">zlabel</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>

</code></pre></div></div> <h2 id="case-1---shifted-dem">Case 1 - Shifted DEM</h2> <p>Nuth &amp; Kaab (2011) showed elevation difference in a 2D scheme with $\alpha$ as the magnitude of the horizontal shift, b as the direction of the shift, which is extremely useful for coregistration when there are enough points and the size and resolution of DEM are relatively manageable.</p> <p><img src="https://i.imgur.com/UzkOHot.png" alt=""></p> <p>We can also plot the variation of elevation difference in a 3D scheme. In this case, I shifted a DTM10 (1.2, -0.7) px horizontaly and 0.16 m vertically on purpose and co-register it back in a brute test.</p> <ul> <li>Brute test calculated the elevation difference in 0.1 px interval over a window (-2 px, 2 px) on east and north.</li> <li>All coregs are shifted base on NMAD.</li> <li>The points are subsampled to 10000, 3000, 1000.</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">xsnow.misc</span> <span class="kn">import</span> <span class="n">dem_shift</span>

<span class="c1"># Shift a DTM10 (1.2,-0.7) px and 0.16 m on purpose
</span><span class="n">dtm_10_shifted</span> <span class="o">=</span> <span class="nf">dem_shift</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.16</span><span class="p">)</span>
<span class="n">dem_tba</span> <span class="o">=</span> <span class="n">dtm_10_shifted</span>
<span class="n">df_ref</span> <span class="o">=</span> <span class="nf">df_sampling_from_dem</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">dem_tba</span><span class="p">,</span><span class="n">samples</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">bond</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">nmad</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_qc</span><span class="p">,</span><span class="n">sampling</span> <span class="ow">in</span> <span class="nf">yield_surface_noise</span><span class="p">(</span><span class="n">dem_tba</span><span class="p">,</span><span class="n">df_ref</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">downsampling_list</span><span class="o">=</span><span class="p">[</span><span class="mi">10000</span><span class="p">,</span><span class="mi">3000</span><span class="p">,</span><span class="mi">1000</span><span class="p">],</span><span class="n">gdc_qc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">z_name</span><span class="o">=</span><span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">):</span>
    <span class="n">z_lim_nmad</span> <span class="o">=</span> <span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">z_lim_rmse</span> <span class="o">=</span> <span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="mf">1.5</span><span class="p">),</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="mi">20</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">z_lim_std</span> <span class="o">=</span> <span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="mf">1.5</span><span class="p">),</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="mi">20</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">projection</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">3d</span><span class="sh">"</span><span class="p">})</span>
    <span class="n">fig</span><span class="p">.</span><span class="nf">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">shifted pixels of DEM longyearbyen on </span><span class="si">{</span><span class="n">sampling</span><span class="si">}</span><span class="s"> points</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">nmad</span><span class="p">,</span> <span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">NMAD</span><span class="sh">'</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span> <span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">NMAD [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_nmad</span><span class="p">,</span><span class="n">zlim_s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">RMSE</span><span class="sh">'</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">RMSE [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_rmse</span><span class="p">,</span><span class="n">zlim_s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">std</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">STD</span><span class="sh">'</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">STD [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_std</span><span class="p">,</span><span class="n">zlim_s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 10000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-1.2031,0.7031,-0.1630),0.1780
Running on downsampling. The length of the gdf: 10000
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
NuthKaab coreg on 10000: (-1.2059757056614222, 0.6973771900864857, -0.16427612, 0.17899064941406248)
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_7_1.png" alt="png" class="center-image"></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 3000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-1.2031,0.7031,-0.1630),0.1780
Running on downsampling. The length of the gdf: 3000
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
NuthKaab coreg on 3000: (-1.199313462032361, 0.6898301972399311, -0.16362, 0.1797598205566406)
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_7_3.png" alt="png" class="center-image"></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 1000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-1.1815,0.6815,-0.1622),0.1794
Running on downsampling. The length of the gdf: 1000
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_7_5.png" alt="png" class="center-image"></p> <h2 id="case-2---dem-longyearbyen-1990-and-longyearbyen-2009">Case 2 - DEM Longyearbyen 1990 and Longyearbyen 2009</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">xsnow.misc</span> <span class="kn">import</span> <span class="n">df_sampling_from_dem</span>
<span class="kn">from</span> <span class="n">xdem</span> <span class="kn">import</span> <span class="n">examples</span>
<span class="kn">from</span> <span class="n">geoutils</span> <span class="kn">import</span> <span class="n">Vector</span><span class="p">,</span><span class="n">Raster</span>

<span class="n">dem_ref</span> <span class="o">=</span> <span class="n">xdem</span><span class="p">.</span><span class="nc">DEM</span><span class="p">(</span><span class="n">examples</span><span class="p">.</span><span class="nf">get_path</span><span class="p">(</span><span class="sh">"</span><span class="s">longyearbyen_ref_dem</span><span class="sh">"</span><span class="p">))</span>
<span class="n">dem_tba</span> <span class="o">=</span> <span class="n">xdem</span><span class="p">.</span><span class="nc">DEM</span><span class="p">(</span><span class="n">examples</span><span class="p">.</span><span class="nf">get_path</span><span class="p">(</span><span class="sh">"</span><span class="s">longyearbyen_tba_dem</span><span class="sh">"</span><span class="p">))</span>
<span class="n">glacier_mask</span> <span class="o">=</span> <span class="nc">Vector</span><span class="p">(</span><span class="n">examples</span><span class="p">.</span><span class="nf">get_path</span><span class="p">(</span><span class="sh">"</span><span class="s">longyearbyen_glacier_outlines</span><span class="sh">"</span><span class="p">))</span>
<span class="n">inlier_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">glacier_mask</span><span class="p">.</span><span class="nf">create_mask</span><span class="p">(</span><span class="n">dem_ref</span><span class="p">)</span>

<span class="n">df_ref</span> <span class="o">=</span> <span class="nf">df_sampling_from_dem</span><span class="p">(</span><span class="n">dem_ref</span><span class="p">,</span><span class="n">dem_tba</span><span class="p">,</span><span class="n">inlier_mask</span><span class="o">=</span><span class="n">inlier_mask</span><span class="p">,</span><span class="n">samples</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="sh">'</span><span class="s">ul</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bond</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># axes limit
</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">nmad</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_qc</span><span class="p">,</span><span class="n">sampling</span> <span class="ow">in</span> <span class="nf">yield_surface_noise</span><span class="p">(</span><span class="n">dem_tba</span><span class="p">,</span> <span class="n">df_ref</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">downsampling_list</span><span class="o">=</span><span class="p">[</span><span class="mi">10000</span><span class="p">,</span><span class="mi">3000</span><span class="p">,</span><span class="mi">1000</span><span class="p">],</span><span class="n">gdc_qc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">z_name</span><span class="o">=</span><span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">):</span>
    <span class="n">z_lim_nmad</span> <span class="o">=</span> <span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">z_lim_rmse</span> <span class="o">=</span> <span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="mf">1.5</span><span class="p">),</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">z_lim_std</span> <span class="o">=</span> <span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="mf">1.5</span><span class="p">),</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">projection</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">3d</span><span class="sh">"</span><span class="p">})</span>
    <span class="n">fig</span><span class="p">.</span><span class="nf">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">shifted pixels of DEM longyearbyen on </span><span class="si">{</span><span class="n">sampling</span><span class="si">}</span><span class="s"> points</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">nmad</span><span class="p">,</span> <span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">NMAD</span><span class="sh">'</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span> <span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">NMAD [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_nmad</span><span class="p">,</span><span class="n">zlim_s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">RMSE</span><span class="sh">'</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">RMSE [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_rmse</span><span class="p">,</span><span class="n">zlim_s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">std</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">STD</span><span class="sh">'</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">STD [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_std</span><span class="p">,</span><span class="n">zlim_s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 10000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-0.5469,-0.1250,-1.8884),2.4996
Running on downsampling. The length of the gdf: 10000
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
NuthKaab coreg on 10000: (-0.44989970346639757, -0.13631736964576785, -1.9579468, 2.543117335510254)
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_10_1.png" alt="png" class="center-image"></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 3000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-0.5000,-0.1562,-1.8764),2.5242
Running on downsampling. The length of the gdf: 3000
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
NuthKaab coreg on 3000: (-0.43152742135357697, -0.17112353846215173, -1.9326782, 2.547257286071777)
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_10_3.png" alt="png" class="center-image"></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 1000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-0.5000,-0.1250,-1.8980),2.5237
Running on downsampling. The length of the gdf: 1000
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_10_5.png" alt="png" class="center-image"></p> <h2 id="case-3---dtm10">Case 3 - DTM10</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bond</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># axes limit
</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">nmad</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_qc</span><span class="p">,</span><span class="n">sampling</span> <span class="ow">in</span> <span class="nf">yield_surface_noise</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">sf_subset_dtm10</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">downsampling_list</span><span class="o">=</span><span class="p">[</span><span class="mi">10000</span><span class="p">,</span><span class="mi">3000</span><span class="p">,</span><span class="mi">1000</span><span class="p">],</span><span class="n">weight</span><span class="o">=</span><span class="sh">'</span><span class="s">subset_te_flag</span><span class="sh">'</span><span class="p">):</span>
    <span class="n">z_lim_nmad</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">z_lim_rmse</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">z_lim_std</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  

    <span class="n">fig</span><span class="p">,(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">projection</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">3d</span><span class="sh">"</span><span class="p">})</span>
    <span class="n">fig</span><span class="p">.</span><span class="nf">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">shifted pixels of DTM10 on </span><span class="si">{</span><span class="n">sampling</span><span class="si">}</span><span class="s"> points</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">nmad</span><span class="p">,</span> <span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">NMAD</span><span class="sh">'</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span> <span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">NMAD [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_nmad</span><span class="p">,</span><span class="n">z_step_level</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">RMSE</span><span class="sh">'</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">RMSE [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_rmse</span><span class="p">,</span><span class="n">z_step_level</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">std</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">STD</span><span class="sh">'</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">STD [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_std</span><span class="p">,</span><span class="n">z_step_level</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 10000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-0.4375,0.2656,-0.0065),0.5992
Running on downsampling. The length of the gdf: 10000
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
NuthKaab coreg on 10000: (-0.43959885000839216, 0.2685718552192047, -0.0128173828125, 0.5952479736328125)
Running best_shift_px on downsampling. The length of the gdf: 10000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-0.4844,0.3125,0.1088),0.3848
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_13_1.png" alt="png" class="center-image"></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 3000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-0.4844,0.1815,-0.0063),0.6086
Running on downsampling. The length of the gdf: 3000
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
NuthKaab coreg on 3000: (-0.4273086350909474, 0.259520889514669, -0.01318359375, 0.5863798828125)
Running best_shift_px on downsampling. The length of the gdf: 3000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-0.4591,0.2909,0.1092),0.3856
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_13_3.png" alt="png" class="center-image"></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 1000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-0.4688,0.5060,-0.0110),0.6305
Running on downsampling. The length of the gdf: 1000
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
Running best_shift_px on downsampling. The length of the gdf: 1000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-0.4627,0.3438,0.1067),0.3884
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_13_5.png" alt="png" class="center-image"></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">xsnow.godh</span> <span class="kn">import</span> <span class="n">get_dh_by_shift_px_gdf</span>

<span class="nf">get_dh_by_shift_px_gdf</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">sf_subset_dtm10</span><span class="p">,(</span><span class="o">-</span><span class="mf">0.4375</span><span class="p">,</span><span class="mf">0.2656</span><span class="p">),</span><span class="n">perc_t</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.5992295654296874
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">get_dh_by_shift_px_gdf</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">sf_subset_dtm10</span><span class="p">,(</span><span class="o">-</span><span class="mf">0.43959885000839216</span><span class="p">,</span> <span class="mf">0.2685718552192047</span><span class="p">),</span><span class="n">perc_t</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.5986866210937499
</code></pre></div></div> <h2 id="case---4-dtm1">Case - 4 DTM1</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bond</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># axes limit
</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">nmad</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_qc</span><span class="p">,</span><span class="n">sampling</span> <span class="ow">in</span> <span class="nf">yield_surface_noise</span><span class="p">(</span><span class="n">dtm_1</span><span class="p">,</span><span class="n">sf_subset_dtm1</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">downsampling_list</span><span class="o">=</span><span class="p">[</span><span class="mi">10000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span><span class="n">gdc_qc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="sh">'</span><span class="s">subset_te_flag</span><span class="sh">'</span><span class="p">):</span>
    <span class="n">z_lim_nmad</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">z_lim_rmse</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">z_lim_std</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">projection</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">3d</span><span class="sh">"</span><span class="p">})</span>
    <span class="n">fig</span><span class="p">.</span><span class="nf">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">shifted pixels of DTM1 on </span><span class="si">{</span><span class="n">sampling</span><span class="si">}</span><span class="s"> points</span><span class="sh">'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">nmad</span><span class="p">,</span> <span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">NMAD</span><span class="sh">'</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span> <span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">NMAD [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_nmad</span><span class="p">,</span><span class="n">z_step_level</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">RMSE</span><span class="sh">'</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">RMSE [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_rmse</span><span class="p">,</span><span class="n">z_step_level</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="nf">surface_plot</span><span class="p">(</span><span class="n">std</span><span class="p">,</span><span class="n">bond</span><span class="o">=</span><span class="n">bond</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">STD</span><span class="sh">'</span><span class="p">,</span><span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">,</span><span class="n">res_1</span><span class="o">=</span><span class="n">res_nk</span><span class="p">,</span><span class="n">res_2</span><span class="o">=</span><span class="n">res_qc</span><span class="p">,</span> <span class="n">zlabel</span><span class="o">=</span><span class="sh">'</span><span class="s">STD [m]</span><span class="sh">'</span><span class="p">,</span><span class="n">zlim</span><span class="o">=</span><span class="n">z_lim_std</span><span class="p">,</span><span class="n">z_step_level</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-1.5000,-1.9375,-0.0508),0.5833
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_18_1.png" alt="png" class="center-image"></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 1000
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-1.7656,0.2284,-0.0659),0.5798
Running on downsampling. The length of the gdf: 1000
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_18_3.png" alt="png" class="center-image"></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running best_shift_px on downsampling. The length of the gdf: 500
Gradient Descending Coreg fit matrix(e_px,n_px,bias),nmad:(-1.9736,-2.0781,-0.0555),0.5788
Running on downsampling. The length of the gdf: 500
Set downsampling = other value or False to make a change.
Warning: There is no curvature in dataframe. Set mask_highcurv = True for more robust results and costs more time
</code></pre></div></div> <p><img src="/assets/img/notebook/xsnow_coreg/xsnow_coreg_18_5.png" alt="png" class="center-image"></p> <h2 id="the-best-fit-algorithm-and-coeficients">The best fit algorithm and coeficients</h2> <p>Gradient descending can also be implemented by L-BFGS-B from Scipy.optimize if the noise is not severe.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="n">xsnow.godh</span> <span class="kn">import</span> <span class="n">get_dh_by_shift_px_gdf</span>

<span class="c1"># start iteration, find the best shifting px
</span><span class="n">func_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nf">get_dh_by_shift_px_gdf</span><span class="p">(</span><span class="n">dtm_10</span><span class="p">,</span><span class="n">sf_subset_dtm10</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">perc_t</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">std_t</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">stat</span><span class="o">=</span><span class="sh">'</span><span class="s">rmse</span><span class="sh">'</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="nf">minimize</span><span class="p">(</span><span class="n">func_x</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="sh">'</span><span class="s">L-BFGS-B</span><span class="sh">'</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">res</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      fun: 1.5511970187060895
 hess_inv: &lt;2x2 LbfgsInvHessProduct with dtype=float64&gt;
      jac: array([0.        , 0.01073706])
  message: 'CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH'
     nfev: 99
      nit: 7
     njev: 33
   status: 0
  success: True
        x: array([-0.09557894,  0.00446687])
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=</span> <span class="nf">minimize</span><span class="p">(</span><span class="n">func_x</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="sh">'</span><span class="s">BFGS</span><span class="sh">'</span><span class="p">)</span>
<span class="n">res</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      fun: 1.5797875171900577
 hess_inv: array([[7.02123e-09, 0.00000e+00],
       [0.00000e+00, 1.00000e+00]])
      jac: array([0.0354276, 0.       ])
  message: 'Desired error not necessarily achieved due to precision loss.'
     nfev: 237
      nit: 2
     njev: 75
   status: 2
  success: False
        x: array([1.37243807e-07, 0.00000000e+00])
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">xsnow.noiseopt</span> <span class="kn">import</span> <span class="n">minimizeCompass</span>
<span class="n">res</span> <span class="o">=</span> <span class="nf">minimizeCompass</span><span class="p">(</span><span class="n">func_x</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">deltainit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">deltatol</span><span class="o">=</span><span class="mf">0.006</span><span class="p">,</span><span class="n">feps</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">errorcontrol</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">res</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    free: array([False, False])
     fun: 1.491898243075958
 message: 'convergence within deltatol'
    nfev: 41
     nit: 14
 success: True
       x: array([-0.359375,  0.25    ])
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=</span> <span class="nf">minimizeCompass</span><span class="p">(</span><span class="n">func_x</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">deltainit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">deltatol</span><span class="o">=</span><span class="mf">0.006</span><span class="p">,</span><span class="n">feps</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">errorcontrol</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">res</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    free: array([ True, False])
     fun: 1.491898243075958
 message: 'convergence within deltatol. dim 0 is free at optimum'
    nfev: 40
     nit: 13
 success: True
       x: array([-0.359375,  0.25    ])
</code></pre></div></div> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> Â© Copyright 2023 Zhihao LIU. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>